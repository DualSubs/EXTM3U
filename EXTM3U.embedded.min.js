// minify: https://www.digitalocean.com/community/tools/minify
// refer: https://datatracker.ietf.org/doc/html/draft-pantos-http-live-streaming-08
function EXTM3U(n){return new class{constructor(n){this.name="EXTM3U v0.8.1",this.opts=n,this.newLine=this.opts.includes("\n")?"\n":this.opts.includes("\r")?"\r":this.opts.includes("\r\n")?"\r\n":"\n"}parse(n=new String){const t=/^(?<TYPE>(?:EXT|AIV)[^#:]+):?(?<OPTION>.+)?[\r\n]?(?<URI>.+)?$/;return n.replace(/\r\n/g,"\n").split(/[\r\n]+#/).map((n=>n.match(t)?.groups??n)).map((n=>(/=/.test(n?.OPTION)&&(n.OPTION=Object.fromEntries(`${n.OPTION},`.split(/,\s*(?![^"]*",)/).slice(0,-1).map((n=>((n=n.split(/=(.*)/))[1]=isNaN(n[1])?n[1].replace(/^"(.*)"$/,"$1"):parseInt(n[1],10),n))))),n)))}stringify(n=new Array){n?.[0]?.includes("#EXTM3U")||n.unshift("#EXTM3U");const t=/^((-?\d+[x.\d]+)|[0-9A-Z-]+)$/;return n.map((n=>("object"==typeof n?.OPTION&&(n.OPTION=Object.entries(n.OPTION).map((s=>("EXT-X-SESSION-DATA"===n.TYPE?s[1]=`"${s[1]}"`:isNaN(s[1])?"INSTREAM-ID"===s[0]?s[1]=`"${s[1]}"`:t.test(s[1])||(s[1]=`"${s[1]}"`):s[1]="number"==typeof s[1]?s[1]:`"${s[1]}"`,s.join("=")))).join(",")),n=n.URI?n.TYPE+":"+n.OPTION+this.newLine+n.URI:n.OPTION?n.TYPE+":"+n.OPTION:n.TYPE?n.TYPE:n))).join(this.newLine+"#")}}(n)}
