// minify: https://www.digitalocean.com/community/tools/minify
export class EXTM3U{constructor(s){this.name="EXTM3U v0.8.2",this.opts=s,this.newLine=this.opts.includes("\n")?"\n":this.opts.includes("\r")?"\r":this.opts.includes("\r\n")?"\r\n":"\n"}parse(s=new String){return[...s.matchAll(/^(?:[\s\r\n]{1})|(?:(?<TAG>#(?:EXT|AIV)[^#:\s\r\n]+)|(?<NOTE>#.+))(?::(?<OPTION>.+))?[\s\r\n]?(?<URI>[^#\s\r\n]+)?$/gm)].map((s=>(s=s?.groups||s,/=/.test(s?.OPTION)&&(s.OPTION=Object.fromEntries(`${s.OPTION},`.split(/,\s*(?![^"]*",)/).slice(0,-1).map((s=>((s=s.split(/=(.*)/))[1]=isNaN(s[1])?s[1].replace(/^"(.*)"$/,"$1"):parseInt(s[1],10),s))))),s)))}stringify(s=new Array){"#EXTM3U"!==s?.[0]?.TAG&&s.unshift({TAG:"#EXTM3U"});const t=/^((-?\d+[x.\d]+)|[0-9A-Z-]+)$/;return s.map((s=>("object"==typeof s?.OPTION&&(s.OPTION=Object.entries(s.OPTION).map((n=>("#EXT-X-SESSION-DATA"===s?.TAG?n[1]=`"${n[1]}"`:isNaN(n[1])?"INSTREAM-ID"===n[0]?n[1]=`"${n[1]}"`:t.test(n[1])||(n[1]=`"${n[1]}"`):n[1]="number"==typeof n[1]?n[1]:`"${n[1]}"`,n.join("=")))).join(",")),s=s?.URI?s.TAG+":"+s.OPTION+this.newLine+s.URI:s?.OPTION?s.TAG+":"+s.OPTION:s?.TAG?s.TAG:s?.NOTE?s.NOTE:""))).join(this.newLine)}}
