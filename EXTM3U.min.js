// minify: https://www.digitalocean.com/community/tools/minify
export class EXTM3U{constructor(opts){this.name="EXTM3U v0.8.6",this.opts=opts,this.newLine=this.opts.includes("\n")?"\n":this.opts.includes("\r")?"\r":this.opts.includes("\r\n")?"\r\n":"\n"}parse(m3u8=new String){return[...m3u8.matchAll(/^(?:(?<TAG>#(?:EXT|AIV)[^#:\s\r\n]+)(?::(?<OPTION>[^\r\n]+))?(?:(?:\r\n|\r|\n)(?<URI>[^#\s\r\n]+))?|(?<NOTE>#[^\r\n]+)?)(?:\r\n|\r|\n)?$/gm)].map((item=>(item=item?.groups||item,/=/.test(item?.OPTION)&&(item.OPTION=Object.fromEntries(`${item.OPTION},`.split(/,\s*(?![^"]*",)/).slice(0,-1).map((option=>((option=option.split(/=(.*)/))[1]=isNaN(option[1])?option[1].replace(/^"(.*)"$/,"$1"):parseInt(option[1],10),option))))),item)))}stringify(json=new Array){"#EXTM3U"!==json?.[0]?.TAG&&json.unshift({TAG:"#EXTM3U"});const OPTION_value_Regex=/^((-?\d+[x.\d]+)|[0-9A-Z-]+)$/;return json.map((item=>("object"==typeof item?.OPTION&&(item.OPTION=Object.entries(item.OPTION).map((option=>("#EXT-X-SESSION-DATA"===item?.TAG?option[1]=`"${option[1]}"`:isNaN(option[1])?"ID"===option[0]||"INSTREAM-ID"===option[0]||"KEYFORMAT"===option[0]?option[1]=`"${option[1]}"`:OPTION_value_Regex.test(option[1])||(option[1]=`"${option[1]}"`):option[1]="number"==typeof option[1]?option[1]:`"${option[1]}"`,option.join("=")))).join(",")),item=item?.URI?item.TAG+":"+item.OPTION+this.newLine+item.URI:item?.OPTION?item.TAG+":"+item.OPTION:item?.TAG?item.TAG:item?.NOTE?item.NOTE:""))).join(this.newLine)}}
