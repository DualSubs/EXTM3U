// minify: https://www.digitalocean.com/community/tools/minify
export class EXTM3U{constructor(t){this.name="EXTM3U v0.8.1",this.opts=t,this.newLine=this.opts.includes("\n")?"\n":this.opts.includes("\r")?"\r":this.opts.includes("\r\n")?"\r\n":"\n"}parse(t=new String){const n=/^(?<TYPE>(?:EXT|AIV)[^#:]+):?(?<OPTION>.+)?[\r\n]?(?<URI>.+)?$/;return t.replace(/\r\n/g,"\n").split(/[\r\n]+#/).map((t=>t.match(n)?.groups??t)).map((t=>(/=/.test(t?.OPTION)&&(t.OPTION=Object.fromEntries(`${t.OPTION},`.split(/,\s*(?![^"]*",)/).slice(0,-1).map((t=>((t=t.split(/=(.*)/))[1]=isNaN(t[1])?t[1].replace(/^"(.*)"$/,"$1"):parseInt(t[1],10),t))))),t)))}stringify(t=new Array){t?.[0]?.includes("#EXTM3U")||t.unshift("#EXTM3U");const n=/^((-?\d+[x.\d]+)|[0-9A-Z-]+)$/;return t.map((t=>("object"==typeof t?.OPTION&&(t.OPTION=Object.entries(t.OPTION).map((s=>("EXT-X-SESSION-DATA"===t.TYPE?s[1]=`"${s[1]}"`:isNaN(s[1])?"INSTREAM-ID"===s[0]?s[1]=`"${s[1]}"`:n.test(s[1])||(s[1]=`"${s[1]}"`):s[1]="number"==typeof s[1]?s[1]:`"${s[1]}"`,s.join("=")))).join(",")),t=t.URI?t.TYPE+":"+t.OPTION+this.newLine+t.URI:t.OPTION?t.TYPE+":"+t.OPTION:t.TYPE?t.TYPE:t))).join(this.newLine+"#")}}
